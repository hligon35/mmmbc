{
  "version": 3,
  "sources": ["../../../src/worker.js"],
  "sourceRoot": "C:\\Users\\Harold Ligon\\Desktop\\MyMobileApps\\MoriahFaithConnect\\mmmbc\\.wrangler\\tmp\\deploy-SvjMgS",
  "sourcesContent": ["// Cloudflare Worker (Option B scaffold)\r\n// - Serves static site assets from ./cf_site via env.ASSETS\r\n// - Implements gallery API + CDN endpoints using D1 + R2\r\n//\r\n// Auth model (Cloudflare-native): protect /admin and /api via Cloudflare Access.\r\n// When Access is enabled, Cloudflare injects cf-access-authenticated-user-email.\r\n\r\nfunction json(resBody, { status = 200, headers = {} } = {}) {\r\n  return new Response(JSON.stringify(resBody), {\r\n    status,\r\n    headers: {\r\n      'Content-Type': 'application/json; charset=utf-8',\r\n      'Cache-Control': 'no-store',\r\n      ...headers\r\n    }\r\n  });\r\n}\r\n\r\nfunction text(body, { status = 200, headers = {} } = {}) {\r\n  return new Response(body, {\r\n    status,\r\n    headers: {\r\n      'Content-Type': 'text/plain; charset=utf-8',\r\n      ...headers\r\n    }\r\n  });\r\n}\r\n\r\nfunction sanitizeSegment(input) {\r\n  return String(input || '')\r\n    .trim()\r\n    .replace(/[^a-zA-Z0-9-_ ]/g, '')\r\n    .replace(/\\s+/g, ' ')\r\n    .slice(0, 80);\r\n}\r\n\r\nfunction sanitizePrefix(input, { fallback = 'gallery/', ensureTrailingSlash = false } = {}) {\r\n  const raw = String(input || '').trim();\r\n  // Allow only path-ish characters; keep '/' so we can browse prefixes.\r\n  let cleaned = raw.replace(/[^a-zA-Z0-9/_-]/g, '');\r\n  cleaned = cleaned.replace(/^\\/+/, '');\r\n  if (!cleaned) cleaned = fallback;\r\n  if (ensureTrailingSlash && !cleaned.endsWith('/')) cleaned += '/';\r\n  return cleaned;\r\n}\r\n\r\nfunction splitTags(raw) {\r\n  return String(raw || '')\r\n    .split(',')\r\n    .map((t) => sanitizeSegment(t).toLowerCase())\r\n    .filter(Boolean)\r\n    .slice(0, 25);\r\n}\r\n\r\nfunction getAccessEmail(request) {\r\n  return (\r\n    request.headers.get('cf-access-authenticated-user-email')\r\n    || request.headers.get('Cf-Access-Authenticated-User-Email')\r\n    || ''\r\n  ).trim().toLowerCase();\r\n}\r\n\r\nfunction hasAccessSessionCookie(request) {\r\n  const cookie = String(request.headers.get('cookie') || '');\r\n  return (\r\n    /(?:^|;\\s*)CF_Authorization(?:_[^=]+)?=/.test(cookie)\r\n    || /(?:^|;\\s*)CF_AppSession=/.test(cookie)\r\n  );\r\n}\r\n\r\nfunction allowList(env) {\r\n  const raw = String(env.ADMIN_ALLOW_EMAILS || '').trim();\r\n  if (!raw) return null;\r\n  return new Set(\r\n    raw\r\n      .split(',')\r\n      .map((s) => s.trim().toLowerCase())\r\n      .filter(Boolean)\r\n  );\r\n}\r\n\r\nfunction isDevBypass(env) {\r\n  const raw = String(env.DEV_BYPASS_AUTH || '').trim().toLowerCase();\r\n  return ['1', 'true', 'yes', 'y', 'on'].includes(raw);\r\n}\r\n\r\nfunction allowServiceTokenAdmin(env) {\r\n  const raw = String(env.ALLOW_SERVICE_TOKEN_ADMIN || '').trim().toLowerCase();\r\n  return ['1', 'true', 'yes', 'y', 'on'].includes(raw);\r\n}\r\n\r\nfunction getHeaderTrim(request, name) {\r\n  return String(request.headers.get(name) || '').trim();\r\n}\r\n\r\nfunction hasServiceTokenHeaders(request) {\r\n  // Cloudflare Access service tokens are presented via these headers.\r\n  const id = getHeaderTrim(request, 'CF-Access-Client-Id') || getHeaderTrim(request, 'cf-access-client-id');\r\n  const secret = getHeaderTrim(request, 'CF-Access-Client-Secret') || getHeaderTrim(request, 'cf-access-client-secret');\r\n  return Boolean(id) && Boolean(secret);\r\n}\r\n\r\nfunction hasValidServiceToken(request, env) {\r\n  // Support server-to-server auth for local admin proxying.\r\n  // If these are set as Worker secrets/vars, we validate and allow.\r\n  const expectedId = String(env.CF_ACCESS_CLIENT_ID || '').trim();\r\n  const expectedSecret = String(env.CF_ACCESS_CLIENT_SECRET || '').trim();\r\n  if (!expectedId || !expectedSecret) return false;\r\n\r\n  const id = getHeaderTrim(request, 'CF-Access-Client-Id') || getHeaderTrim(request, 'cf-access-client-id');\r\n  const secret = getHeaderTrim(request, 'CF-Access-Client-Secret') || getHeaderTrim(request, 'cf-access-client-secret');\r\n  if (!id || !secret) return false;\r\n\r\n  return id === expectedId && secret === expectedSecret;\r\n}\r\n\r\nfunction hasAccessJwtAssertion(request) {\r\n  return Boolean(\r\n    getHeaderTrim(request, 'cf-access-jwt-assertion')\r\n    || getHeaderTrim(request, 'Cf-Access-Jwt-Assertion')\r\n  );\r\n}\r\n\r\nfunction requireAdmin(request, env) {\r\n  if (isDevBypass(env)) return { ok: true, email: 'dev@local' };\r\n\r\n  // Strong path: validate the service token headers against Worker secrets.\r\n  if (hasValidServiceToken(request, env)) {\r\n    return { ok: true, email: 'service-token@access' };\r\n  }\r\n\r\n  // Allow Access Service Tokens (useful for automation/migrations) when enabled.\r\n  // NOTE: If Cloudflare Access is in front of this Worker, it will validate the\r\n  // service token at the edge and typically inject a JWT assertion header.\r\n  // In that case we can allow without having the token values in Worker env.\r\n  if (allowServiceTokenAdmin(env) && hasServiceTokenHeaders(request) && hasAccessJwtAssertion(request)) {\r\n    return { ok: true, email: 'service-token@access' };\r\n  }\r\n\r\n  const email = getAccessEmail(request);\r\n  if (!email) return { ok: false, error: 'Unauthorized (Cloudflare Access required)' };\r\n  const allow = allowList(env);\r\n  if (allow && !allow.has(email)) return { ok: false, error: 'Forbidden' };\r\n  return { ok: true, email };\r\n}\r\n\r\nasync function handleSupportMessage(request, env) {\r\n  const auth = requireAdmin(request, env);\r\n  if (!auth.ok) return json({ error: auth.error }, { status: 401 });\r\n\r\n  const body = await request.json().catch(() => null);\r\n  const subjectRaw = String(body?.subject || '').trim();\r\n  const messageRaw = String(body?.message || '').trim();\r\n  const replyToRaw = String(body?.replyTo || '').trim();\r\n\r\n  if (!subjectRaw || !messageRaw) return json({ error: 'Subject and message are required.' }, { status: 400 });\r\n\r\n  const subject = subjectRaw.slice(0, 140);\r\n  const message = messageRaw.slice(0, 5000);\r\n  const replyTo = replyToRaw && /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(replyToRaw) ? replyToRaw : '';\r\n\r\n  const toEmail = String(env.SUPPORT_TO_EMAIL || 'hligon@getsparqd.com').trim();\r\n  const fromEmail = String(env.SUPPORT_FROM_EMAIL || 'no-reply@mmmbc.com').trim();\r\n  const fromName = String(env.SUPPORT_FROM_NAME || 'MMMBC Admin Support').trim() || 'MMMBC Admin Support';\r\n\r\n  const composedSubject = `[MMMBC Support] ${subject}`;\r\n  const textBody = [\r\n    `From (admin): ${auth.email}`,\r\n    replyTo ? `Reply-To: ${replyTo}` : 'Reply-To: (not provided)',\r\n    '',\r\n    message\r\n  ].join('\\n');\r\n\r\n  const payload = {\r\n    personalizations: [{ to: [{ email: toEmail }], subject: composedSubject }],\r\n    from: { email: fromEmail, name: fromName },\r\n    ...(replyTo ? { reply_to: { email: replyTo } } : {}),\r\n    content: [{ type: 'text/plain', value: textBody }]\r\n  };\r\n\r\n  const res = await fetch('https://api.mailchannels.net/tx/v1/send', {\r\n    method: 'POST',\r\n    headers: { 'content-type': 'application/json' },\r\n    body: JSON.stringify(payload)\r\n  });\r\n\r\n  if (!res.ok) {\r\n    const errText = await res.text().catch(() => '');\r\n    return json({ error: `Email send failed (${res.status}). ${errText}`.trim() }, { status: 502 });\r\n  }\r\n\r\n  return json({ ok: true });\r\n}\r\n\r\nfunction guessContentType(key) {\r\n  const k = String(key || '').toLowerCase();\r\n  if (k.endsWith('.jpg') || k.endsWith('.jpeg')) return 'image/jpeg';\r\n  if (k.endsWith('.png')) return 'image/png';\r\n  if (k.endsWith('.webp')) return 'image/webp';\r\n  if (k.endsWith('.gif')) return 'image/gif';\r\n  return 'application/octet-stream';\r\n}\r\n\r\nasync function listGallery(env) {\r\n  const rows = await env.DB.prepare(\r\n    `SELECT id, album, label, tags_json, file_key, thumb_key, original_name, created_at, position\r\n     FROM gallery_items`\r\n  ).all();\r\n\r\n  const items = (rows.results || []).map((r) => {\r\n    const tags = (() => {\r\n      try {\r\n        const parsed = JSON.parse(r.tags_json || '[]');\r\n        return Array.isArray(parsed) ? parsed : [];\r\n      } catch {\r\n        return [];\r\n      }\r\n    })();\r\n\r\n    return {\r\n      id: r.id,\r\n      album: r.album,\r\n      label: r.label,\r\n      tags,\r\n      file: `/cdn/gallery/${encodeURI(r.file_key)}`,\r\n      thumb: r.thumb_key ? `/cdn/gallery/${encodeURI(r.thumb_key)}` : `/cdn/gallery/${encodeURI(r.file_key)}`,\r\n      originalName: r.original_name,\r\n      createdAt: r.created_at,\r\n      position: r.position\r\n    };\r\n  });\r\n\r\n  return { items };\r\n}\r\n\r\nasync function handlePublicGallery(request, env) {\r\n  // Public endpoint: drives the public photo gallery page.\r\n  // Note: if your Cloudflare Access policy currently protects ALL /api paths,\r\n  // we keep this under /public so it can remain unprotected.\r\n  const data = await listGallery(env);\r\n  return json(data, {\r\n    status: 200,\r\n    headers: {\r\n      'Cache-Control': 'no-store',\r\n      'Access-Control-Allow-Origin': '*'\r\n    }\r\n  });\r\n}\r\n\r\nfunction splitKeyUnderPrefix(key, prefix) {\r\n  const k = String(key || '');\r\n  const p = String(prefix || '');\r\n  if (!k.startsWith(p)) return null;\r\n  const rest = k.slice(p.length);\r\n  if (!rest) return null;\r\n  const first = rest.split('/')[0];\r\n  if (!first) return null;\r\n  const isFolder = rest.includes('/') && !rest.endsWith(first);\r\n  return { first, rest, isFolder };\r\n}\r\n\r\nasync function handleR2Tree(request, env) {\r\n  const auth = requireAdmin(request, env);\r\n  if (!auth.ok) return json({ error: auth.error }, { status: 401 });\r\n\r\n  const url = new URL(request.url);\r\n  let prefix = sanitizePrefix(url.searchParams.get('prefix') || 'gallery/', {\r\n    fallback: 'gallery/',\r\n    ensureTrailingSlash: true\r\n  });\r\n  if (!prefix.startsWith('gallery/')) prefix = 'gallery/';\r\n  const limitRaw = Number(url.searchParams.get('limit') || 250);\r\n  const limit = Number.isFinite(limitRaw) ? Math.max(1, Math.min(1000, Math.trunc(limitRaw))) : 250;\r\n  const cursor = String(url.searchParams.get('cursor') || '').trim() || undefined;\r\n\r\n  const listed = await env.GALLERY_BUCKET.list({ prefix, limit, cursor });\r\n  const folders = new Map();\r\n  const files = [];\r\n\r\n  for (const o of (listed.objects || [])) {\r\n    const parsed = splitKeyUnderPrefix(o.key, prefix);\r\n    if (!parsed) continue;\r\n    if (parsed.rest.includes('/')) {\r\n      const folderPrefix = `${prefix}${parsed.first}/`;\r\n      if (!folders.has(parsed.first)) {\r\n        folders.set(parsed.first, { name: parsed.first, prefix: folderPrefix });\r\n      }\r\n    } else {\r\n      files.push({\r\n        name: parsed.first,\r\n        key: o.key,\r\n        size: o.size,\r\n        etag: o.etag,\r\n        uploaded: o.uploaded\r\n      });\r\n    }\r\n  }\r\n\r\n  const folderList = Array.from(folders.values()).sort((a, b) => a.name.localeCompare(b.name));\r\n  files.sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n  return json({\r\n    ok: true,\r\n    prefix,\r\n    limit,\r\n    cursor: cursor || null,\r\n    truncated: Boolean(listed.truncated),\r\n    nextCursor: listed.truncated ? listed.cursor : null,\r\n    folders: folderList,\r\n    files\r\n  });\r\n}\r\n\r\nasync function handleR2DeleteObject(request, env) {\r\n  const auth = requireAdmin(request, env);\r\n  if (!auth.ok) return json({ error: auth.error }, { status: 401 });\r\n\r\n  const url = new URL(request.url);\r\n  const key = String(url.searchParams.get('key') || '').trim();\r\n  if (!key) return json({ error: 'key is required' }, { status: 400 });\r\n  if (!key.startsWith('gallery/')) return json({ error: 'Only gallery/ keys can be deleted here.' }, { status: 400 });\r\n\r\n  await env.GALLERY_BUCKET.delete(key);\r\n\r\n  // Keep DB in sync if this key had a record.\r\n  try {\r\n    await env.DB.prepare(\r\n      'DELETE FROM gallery_items WHERE file_key=? OR thumb_key=?'\r\n    ).bind(key, key).run();\r\n  } catch {\r\n    // ignore\r\n  }\r\n\r\n  return json({ ok: true, deleted: key });\r\n}\r\n\r\nasync function handleGallerySyncFromR2(request, env) {\r\n  const auth = requireAdmin(request, env);\r\n  if (!auth.ok) return json({ error: auth.error }, { status: 401 });\r\n\r\n  const url = new URL(request.url);\r\n  let prefix = sanitizePrefix(url.searchParams.get('prefix') || 'gallery/', {\r\n    fallback: 'gallery/',\r\n    ensureTrailingSlash: false\r\n  });\r\n  if (!prefix.startsWith('gallery/')) prefix = 'gallery/';\r\n  const limitRaw = Number(url.searchParams.get('limit') || 250);\r\n  const limit = Number.isFinite(limitRaw) ? Math.max(1, Math.min(1000, Math.trunc(limitRaw))) : 250;\r\n  const cursor = String(url.searchParams.get('cursor') || '').trim() || undefined;\r\n\r\n  const listed = await env.GALLERY_BUCKET.list({ prefix, limit, cursor });\r\n  const objects = listed.objects || [];\r\n\r\n  let added = 0;\r\n  let existing = 0;\r\n\r\n  for (const o of objects) {\r\n    const key = String(o.key || '');\r\n    if (!key || key.endsWith('/')) continue;\r\n    if (!key.startsWith('gallery/')) continue;\r\n\r\n    const found = await env.DB.prepare(\r\n      'SELECT id FROM gallery_items WHERE file_key=? LIMIT 1'\r\n    ).bind(key).first();\r\n\r\n    if (found?.id) {\r\n      existing += 1;\r\n      continue;\r\n    }\r\n\r\n    const parts = key.split('/');\r\n    const album = sanitizeSegment(parts[1] || 'General') || 'General';\r\n    const originalName = String(parts[parts.length - 1] || 'image');\r\n    const createdAt = (() => {\r\n      try {\r\n        const d = o.uploaded ? new Date(o.uploaded) : new Date();\r\n        return d.toISOString();\r\n      } catch {\r\n        return new Date().toISOString();\r\n      }\r\n    })();\r\n\r\n    const id = crypto.randomUUID();\r\n    await env.DB.prepare(\r\n      `INSERT INTO gallery_items (id, album, label, tags_json, file_key, thumb_key, original_name, created_at, position)\r\n       VALUES (?, ?, '', '[]', ?, NULL, ?, ?, NULL)`\r\n    ).bind(id, album, key, originalName, createdAt).run();\r\n\r\n    added += 1;\r\n  }\r\n\r\n  return json({\r\n    ok: true,\r\n    prefix,\r\n    limit,\r\n    cursor: cursor || null,\r\n    processed: objects.length,\r\n    added,\r\n    existing,\r\n    truncated: Boolean(listed.truncated),\r\n    nextCursor: listed.truncated ? listed.cursor : null\r\n  });\r\n}\r\n\r\nasync function handleGalleryUpload(request, env) {\r\n  const auth = requireAdmin(request, env);\r\n  if (!auth.ok) return json({ error: auth.error }, { status: 401 });\r\n\r\n  const ct = request.headers.get('content-type') || '';\r\n  if (!ct.toLowerCase().includes('multipart/form-data')) {\r\n    return json({ error: 'Expected multipart/form-data' }, { status: 400 });\r\n  }\r\n\r\n  const form = await request.formData();\r\n  const album = sanitizeSegment(form.get('album') || 'General') || 'General';\r\n  const label = sanitizeSegment(form.get('label') || '') || '';\r\n  const tags = splitTags(form.get('tags') || '');\r\n\r\n  const files = form.getAll('images').filter((f) => f && typeof f === 'object' && 'arrayBuffer' in f);\r\n  if (!files.length) return json({ error: 'No images uploaded.' }, { status: 400 });\r\n\r\n  const added = [];\r\n  for (const file of files) {\r\n    const id = crypto.randomUUID();\r\n    const originalName = String(file.name || 'image');\r\n    const safeBase = sanitizeSegment(originalName.replace(/\\.[^.]+$/, '')).replace(/\\s+/g, '-') || 'image';\r\n    const ext = (originalName.split('.').pop() || 'jpg').toLowerCase().replace(/[^a-z0-9]/g, '');\r\n    const createdAt = new Date().toISOString();\r\n\r\n    const fileKey = `gallery/${album}/${createdAt.slice(0, 10)}_${safeBase}_${id}.${ext || 'jpg'}`;\r\n\r\n    // Store original in R2\r\n    await env.GALLERY_BUCKET.put(fileKey, await file.arrayBuffer(), {\r\n      httpMetadata: {\r\n        contentType: file.type || guessContentType(fileKey)\r\n      }\r\n    });\r\n\r\n    // No server-side thumbnail generation in Workers (sharp not available).\r\n    // For now, thumb == original; later we can add client-generated thumbs.\r\n    const thumbKey = null;\r\n\r\n    await env.DB.prepare(\r\n      `INSERT INTO gallery_items (id, album, label, tags_json, file_key, thumb_key, original_name, created_at, position)\r\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?, NULL)`\r\n    ).bind(\r\n      id,\r\n      album,\r\n      label,\r\n      JSON.stringify(tags),\r\n      fileKey,\r\n      thumbKey,\r\n      originalName,\r\n      createdAt\r\n    ).run();\r\n\r\n    added.push({\r\n      id,\r\n      album,\r\n      label,\r\n      tags,\r\n      file: `/cdn/gallery/${encodeURI(fileKey)}`,\r\n      thumb: `/cdn/gallery/${encodeURI(fileKey)}`,\r\n      originalName,\r\n      createdAt,\r\n      position: null\r\n    });\r\n  }\r\n\r\n  return json({ ok: true, added });\r\n}\r\n\r\nasync function handleGalleryOrder(request, env) {\r\n  const auth = requireAdmin(request, env);\r\n  if (!auth.ok) return json({ error: auth.error }, { status: 401 });\r\n\r\n  const body = await request.json().catch(() => ({}));\r\n  const album = sanitizeSegment(body?.album || '');\r\n  const orderedIds = Array.isArray(body?.orderedIds) ? body.orderedIds.map((x) => String(x)) : [];\r\n  if (!album) return json({ error: 'Album is required.' }, { status: 400 });\r\n  if (!orderedIds.length) return json({ error: 'orderedIds is required.' }, { status: 400 });\r\n\r\n  // Transaction-like: set positions for ids in order.\r\n  for (let i = 0; i < orderedIds.length; i += 1) {\r\n    await env.DB.prepare(\r\n      `UPDATE gallery_items SET position=? WHERE id=? AND album=?`\r\n    ).bind(i, orderedIds[i], album).run();\r\n  }\r\n\r\n  return json({ ok: true });\r\n}\r\n\r\nasync function handleGalleryUpdate(request, env, id) {\r\n  const auth = requireAdmin(request, env);\r\n  if (!auth.ok) return json({ error: auth.error }, { status: 401 });\r\n\r\n  const body = await request.json().catch(() => ({}));\r\n  const label = sanitizeSegment(body?.label || '') || '';\r\n  const tags = splitTags(body?.tags || '');\r\n\r\n  const existing = await env.DB.prepare(\r\n    `SELECT id, album, label, tags_json, file_key, thumb_key, original_name, created_at, position\r\n     FROM gallery_items WHERE id=?`\r\n  ).bind(String(id)).first();\r\n\r\n  if (!existing) return json({ error: 'Not found' }, { status: 404 });\r\n\r\n  await env.DB.prepare(\r\n    `UPDATE gallery_items SET label=?, tags_json=? WHERE id=?`\r\n  ).bind(label, JSON.stringify(tags), String(id)).run();\r\n\r\n  return json({\r\n    ok: true,\r\n    item: {\r\n      id: existing.id,\r\n      album: existing.album,\r\n      label,\r\n      tags,\r\n      file: `/cdn/gallery/${encodeURI(existing.file_key)}`,\r\n      thumb: existing.thumb_key ? `/cdn/gallery/${encodeURI(existing.thumb_key)}` : `/cdn/gallery/${encodeURI(existing.file_key)}`,\r\n      originalName: existing.original_name,\r\n      createdAt: existing.created_at,\r\n      position: existing.position\r\n    }\r\n  });\r\n}\r\n\r\nasync function handleGalleryDelete(request, env, id) {\r\n  const auth = requireAdmin(request, env);\r\n  if (!auth.ok) return json({ error: auth.error }, { status: 401 });\r\n\r\n  const row = await env.DB.prepare(\r\n    `SELECT file_key, thumb_key FROM gallery_items WHERE id=?`\r\n  ).bind(id).first();\r\n\r\n  if (!row) return json({ error: 'Not found' }, { status: 404 });\r\n\r\n  try {\r\n    if (row.file_key) await env.GALLERY_BUCKET.delete(row.file_key);\r\n    if (row.thumb_key) await env.GALLERY_BUCKET.delete(row.thumb_key);\r\n  } catch {\r\n    // ignore\r\n  }\r\n\r\n  await env.DB.prepare(`DELETE FROM gallery_items WHERE id=?`).bind(id).run();\r\n  return json({ ok: true });\r\n}\r\n\r\nasync function handleR2List(request, env) {\r\n  const auth = requireAdmin(request, env);\r\n  if (!auth.ok) return json({ error: auth.error }, { status: 401 });\r\n\r\n  const url = new URL(request.url);\r\n  let prefix = sanitizePrefix(url.searchParams.get('prefix') || 'gallery/', { fallback: 'gallery/', ensureTrailingSlash: false });\r\n  if (!prefix.startsWith('gallery/')) prefix = 'gallery/';\r\n  const limitRaw = Number(url.searchParams.get('limit') || 50);\r\n  const limit = Number.isFinite(limitRaw) ? Math.max(1, Math.min(1000, Math.trunc(limitRaw))) : 50;\r\n  const cursor = String(url.searchParams.get('cursor') || '').trim() || undefined;\r\n\r\n  const listed = await env.GALLERY_BUCKET.list({ prefix, limit, cursor });\r\n  return json({\r\n    ok: true,\r\n    prefix,\r\n    limit,\r\n    cursor: cursor || null,\r\n    truncated: Boolean(listed.truncated),\r\n    nextCursor: listed.truncated ? listed.cursor : null,\r\n    objects: (listed.objects || []).map((o) => ({\r\n      key: o.key,\r\n      size: o.size,\r\n      etag: o.etag,\r\n      uploaded: o.uploaded\r\n    }))\r\n  });\r\n}\r\n\r\nasync function handleR2Migrate(request, env) {\r\n  const auth = requireAdmin(request, env);\r\n  if (!auth.ok) return json({ error: auth.error }, { status: 401 });\r\n\r\n  const src = env.GALLERY_BUCKET_SRC;\r\n  const dst = env.GALLERY_BUCKET_DST;\r\n  if (!src || !dst || typeof src.list !== 'function' || typeof src.get !== 'function' || typeof dst.put !== 'function') {\r\n    return json({\r\n      error: 'Migration buckets not configured. Bind GALLERY_BUCKET_SRC and GALLERY_BUCKET_DST in wrangler.jsonc.'\r\n    }, { status: 500 });\r\n  }\r\n\r\n  const url = new URL(request.url);\r\n  let prefix = sanitizePrefix(url.searchParams.get('prefix') || 'gallery/', { fallback: 'gallery/', ensureTrailingSlash: false });\r\n  if (!prefix.startsWith('gallery/')) prefix = 'gallery/';\r\n  const limitRaw = Number(url.searchParams.get('limit') || 100);\r\n  const limit = Number.isFinite(limitRaw) ? Math.max(1, Math.min(500, Math.trunc(limitRaw))) : 100;\r\n  const cursor = String(url.searchParams.get('cursor') || '').trim() || undefined;\r\n\r\n  const overwrite = ['1', 'true', 'yes', 'y', 'on'].includes(String(url.searchParams.get('overwrite') || '').trim().toLowerCase());\r\n  const dryRun = ['1', 'true', 'yes', 'y', 'on'].includes(String(url.searchParams.get('dryRun') || '').trim().toLowerCase());\r\n\r\n  const listed = await src.list({ prefix, limit, cursor });\r\n  const objects = listed.objects || [];\r\n\r\n  let copied = 0;\r\n  let skipped = 0;\r\n  let missing = 0;\r\n  const errors = [];\r\n\r\n  for (const obj of objects) {\r\n    const key = obj.key;\r\n    try {\r\n      if (!overwrite) {\r\n        const existing = await dst.head(key);\r\n        if (existing) {\r\n          skipped += 1;\r\n          continue;\r\n        }\r\n      }\r\n\r\n      if (dryRun) {\r\n        copied += 1;\r\n        continue;\r\n      }\r\n\r\n      const srcObj = await src.get(key);\r\n      if (!srcObj) {\r\n        missing += 1;\r\n        continue;\r\n      }\r\n\r\n      await dst.put(key, srcObj.body, {\r\n        httpMetadata: srcObj.httpMetadata,\r\n        customMetadata: srcObj.customMetadata\r\n      });\r\n      copied += 1;\r\n    } catch (e) {\r\n      const msg = (e && (e.stack || e.message)) ? String(e.stack || e.message) : String(e);\r\n      errors.push({ key, error: msg.slice(0, 500) });\r\n    }\r\n  }\r\n\r\n  return json({\r\n    ok: true,\r\n    prefix,\r\n    limit,\r\n    cursor: cursor || null,\r\n    processed: objects.length,\r\n    copied,\r\n    skipped,\r\n    missing,\r\n    errors,\r\n    truncated: Boolean(listed.truncated),\r\n    nextCursor: listed.truncated ? listed.cursor : null\r\n  });\r\n}\r\n\r\nasync function handleCdn(request, env) {\r\n  const prefix = '/cdn/gallery/';\r\n  const url = new URL(request.url);\r\n  const key = decodeURI(url.pathname.slice(prefix.length));\r\n  if (!key) return new Response('Not found', { status: 404 });\r\n\r\n  const obj = await env.GALLERY_BUCKET.get(key);\r\n  if (!obj) return new Response('Not found', { status: 404 });\r\n\r\n  const headers = new Headers();\r\n  obj.writeHttpMetadata(headers);\r\n  headers.set('Content-Type', headers.get('Content-Type') || guessContentType(key));\r\n  headers.set('Cache-Control', 'public, max-age=31536000, immutable');\r\n  headers.set('Cross-Origin-Resource-Policy', 'cross-origin');\r\n\r\n  return new Response(obj.body, { status: 200, headers });\r\n}\r\n\r\nexport default {\r\n  async fetch(request, env, ctx) {\r\n    const url = new URL(request.url);\r\n\r\n    // Admin entrypoint: send unauthenticated users to the custom login page.\r\n    // Note: keep this narrow so that /admin/login.html can load its CSS/JS.\r\n    if (\r\n      request.method === 'GET'\r\n      && (url.pathname === '/admin' || url.pathname === '/admin/' || url.pathname === '/admin/index.html')\r\n      && !isDevBypass(env)\r\n      && !getAccessEmail(request)\r\n      && !hasAccessSessionCookie(request)\r\n    ) {\r\n      return Response.redirect(`${url.origin}/admin/login.html`, 302);\r\n    }\r\n\r\n    // Public gallery feed (used by the public Photo Gallery page)\r\n    if ((url.pathname === '/public/gallery.json' || url.pathname === '/public/gallery') && request.method === 'GET') {\r\n      return handlePublicGallery(request, env);\r\n    }\r\n\r\n    // CDN endpoint for gallery objects in R2\r\n    if (url.pathname.startsWith('/cdn/gallery/')) {\r\n      return handleCdn(request, env);\r\n    }\r\n\r\n    // Minimal API\r\n    if (url.pathname === '/api/me' && request.method === 'GET') {\r\n      const email = getAccessEmail(request);\r\n      if (!email && !isDevBypass(env)) return json({ user: null });\r\n      return json({ user: { id: email || 'dev', email: email || 'dev@local', role: 'admin', name: '', isMaster: false, mustOnboard: false, twoFactorEnabled: false } });\r\n    }\r\n\r\n    if (url.pathname === '/api/gallery' && request.method === 'GET') {\r\n      const auth = requireAdmin(request, env);\r\n      if (!auth.ok) return json({ error: auth.error }, { status: 401 });\r\n      return json(await listGallery(env));\r\n    }\r\n\r\n    if (url.pathname === '/api/gallery/upload' && request.method === 'POST') {\r\n      return handleGalleryUpload(request, env);\r\n    }\r\n\r\n    if (url.pathname === '/api/gallery/order' && request.method === 'PUT') {\r\n      return handleGalleryOrder(request, env);\r\n    }\r\n\r\n    if (url.pathname.startsWith('/api/gallery/') && request.method === 'PUT') {\r\n      const id = url.pathname.split('/').pop();\r\n      return handleGalleryUpdate(request, env, id);\r\n    }\r\n\r\n    // Diagnostic: list objects in the configured R2 bucket (admin only)\r\n    if (url.pathname === '/api/gallery/r2list' && request.method === 'GET') {\r\n      return handleR2List(request, env);\r\n    }\r\n\r\n    // Admin-only: browse R2 objects by \"folder\" prefix\r\n    if (url.pathname === '/api/gallery/r2tree' && request.method === 'GET') {\r\n      return handleR2Tree(request, env);\r\n    }\r\n\r\n    // Admin-only: delete an R2 object by key (and remove DB row if any)\r\n    if (url.pathname === '/api/gallery/r2object' && request.method === 'DELETE') {\r\n      return handleR2DeleteObject(request, env);\r\n    }\r\n\r\n    // Admin-only: sync D1 gallery rows from current R2 contents (paginated)\r\n    if (url.pathname === '/api/gallery/sync' && request.method === 'POST') {\r\n      return handleGallerySyncFromR2(request, env);\r\n    }\r\n\r\n    // Admin-only: migrate/copy objects between two R2 buckets (paginated)\r\n    // Requires wrangler bindings: GALLERY_BUCKET_SRC (source) and GALLERY_BUCKET_DST (destination)\r\n    if (url.pathname === '/api/gallery/r2migrate' && request.method === 'GET') {\r\n      return handleR2Migrate(request, env);\r\n    }\r\n\r\n    if (url.pathname.startsWith('/api/gallery/') && request.method === 'DELETE') {\r\n      const id = url.pathname.split('/').pop();\r\n      return handleGalleryDelete(request, env, id);\r\n    }\r\n\r\n    // Health\r\n    if (url.pathname === '/api/admin/health') {\r\n      const auth = requireAdmin(request, env);\r\n      if (!auth.ok) return json({ error: auth.error }, { status: 401 });\r\n      return json({ ok: true, time: new Date().toISOString() });\r\n    }\r\n\r\n    // Support messages (admin only)\r\n    if (url.pathname === '/api/support/message' && request.method === 'POST') {\r\n      return handleSupportMessage(request, env);\r\n    }\r\n\r\n    // Static assets (public site + admin UI) from ./cf_site\r\n    if (!env.ASSETS || typeof env.ASSETS.fetch !== 'function') {\r\n      return text('Assets binding missing. Check wrangler.jsonc assets config.', { status: 500 });\r\n    }\r\n\r\n    return env.ASSETS.fetch(request);\r\n  }\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
