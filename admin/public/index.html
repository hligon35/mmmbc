<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MMMBC Admin Dashboard</title>
  <meta name="description" content="Admin dashboard for Mt. Moriah Missionary Baptist Church website." />
  <link rel="stylesheet" href="admin.css" />
</head>
<body>
  <a class="skip-link" href="#app">Skip to content</a>

  <header class="header">
    <div class="header__left">
      <img class="header__logo" src="/Icons/favicon.png" alt="MMMBC" />
    </div>
    <div class="header__center" aria-label="Admin Dashboard">
      <div class="header__title">Admin Dashboard</div>
    </div>
    <div class="header__right">
      <span class="status" id="authStatus" aria-live="polite">Checking login…</span>
      <button class="btn" id="logoutBtn" type="button" hidden>Log out</button>
    </div>
  </header>

  <main id="app" class="app" role="main">
    <section class="card loginCard" id="loginCard" aria-label="Login">
      <h1 class="card__title">Sign in</h1>
      <p class="muted">Use your admin email and password.</p>

      <div class="card" id="accessOnlyPanel" hidden>
        <div class="card__subtitle">Cloudflare Access sign-in</div>
        <p class="muted">This deployment is protected by Cloudflare Access. Use the Access login, then refresh this page.</p>
        <a class="btn btn--primary" id="accessLoginBtn" href="/admin/login.html">Continue to sign-in</a>
      </div>

      <form id="loginForm" class="form">
        <label class="label">
          Email
          <input class="input" name="email" type="email" autocomplete="username" required />
        </label>
        <label class="label">
          Password
          <div class="inputGroup">
            <input class="input" id="loginPassword" name="password" type="password" autocomplete="current-password" required />
            <button class="peekBtn" type="button" data-peek-target="loginPassword" aria-label="Show password" aria-pressed="false">
              <svg class="peekBtn__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path fill="currentColor" d="M12 5c-5.5 0-9.6 4.2-11 7 1.4 2.8 5.5 7 11 7s9.6-4.2 11-7c-1.4-2.8-5.5-7-11-7zm0 11.5A4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 0 1 0 9zm0-2.2a2.3 2.3 0 1 0 0-4.6 2.3 2.3 0 0 0 0 4.6z"/>
              </svg>
            </button>
          </div>
        </label>
        <button class="btn btn--primary" type="submit">Sign in</button>
        <button class="linkBtn" id="forgotToggle" type="button">Forgot login?</button>
        <div class="error" id="loginError" role="alert" hidden></div>
      </form>

      <div class="collapse" id="forgotPanel" hidden>
        <div class="divider"></div>
        <h2 class="card__subtitle">Recover account</h2>
        <p class="muted">If you have the recovery code, you can reset your password here.</p>
        <form id="recoverForm" class="form">
          <label class="label">
            Email
            <input class="input" name="email" type="email" autocomplete="username" required />
          </label>
          <label class="label">
            Recovery code
            <input class="input" name="recoveryCode" type="text" autocomplete="one-time-code" required />
          </label>
          <label class="label">
            New password
            <div class="inputGroup">
              <input class="input" id="recoverNewPassword" name="newPassword" type="password" autocomplete="new-password" required />
              <button class="peekBtn" type="button" data-peek-target="recoverNewPassword" aria-label="Show password" aria-pressed="false">
                <svg class="peekBtn__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path fill="currentColor" d="M12 5c-5.5 0-9.6 4.2-11 7 1.4 2.8 5.5 7 11 7s9.6-4.2 11-7c-1.4-2.8-5.5-7-11-7zm0 11.5A4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 0 1 0 9zm0-2.2a2.3 2.3 0 1 0 0-4.6 2.3 2.3 0 0 0 0 4.6z"/>
                </svg>
              </button>
            </div>
            <div class="pwHelp" id="recoverPwHelp">
              <div class="pwHelp__row"><meter class="pwMeter" id="recoverPwMeter" min="0" max="4" value="0"></meter><span class="pwMeter__text" id="recoverPwText">Password strength</span></div>
              <ul class="pwRules" aria-label="Password requirements">
                <li>At least 8 characters</li>
                <li>At least 1 capital letter</li>
                <li>At least 1 special character</li>
              </ul>
            </div>
          </label>
          <label class="label">
            Confirm new password
            <div class="inputGroup">
              <input class="input" id="recoverConfirmPassword" name="confirmPassword" type="password" autocomplete="new-password" required />
              <button class="peekBtn" type="button" data-peek-target="recoverConfirmPassword" aria-label="Show password" aria-pressed="false">
                <svg class="peekBtn__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path fill="currentColor" d="M12 5c-5.5 0-9.6 4.2-11 7 1.4 2.8 5.5 7 11 7s9.6-4.2 11-7c-1.4-2.8-5.5-7-11-7zm0 11.5A4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 0 1 0 9zm0-2.2a2.3 2.3 0 1 0 0-4.6 2.3 2.3 0 0 0 0 4.6z"/>
                </svg>
              </button>
            </div>
          </label>
          <button class="btn btn--primary" type="submit">Reset password</button>
          <div class="hint" id="recoverHint" aria-live="polite"></div>
        </form>
      </div>
    </section>

    <section class="card loginCard" id="inviteCard" aria-label="Account setup" hidden>
      <h1 class="card__title">Finish account setup</h1>
      <p class="muted" id="inviteEmail">Loading invite…</p>

      <form id="inviteForm" class="form">
        <label class="label">
          Your name
          <input class="input" name="name" type="text" autocomplete="name" required />
        </label>

        <label class="label">
          New password
          <div class="inputGroup">
            <input class="input" id="inviteNewPassword" name="newPassword" type="password" autocomplete="new-password" required />
            <button class="peekBtn" type="button" data-peek-target="inviteNewPassword" aria-label="Show password" aria-pressed="false">
              <svg class="peekBtn__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path fill="currentColor" d="M12 5c-5.5 0-9.6 4.2-11 7 1.4 2.8 5.5 7 11 7s9.6-4.2 11-7c-1.4-2.8-5.5-7-11-7zm0 11.5A4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 0 1 0 9zm0-2.2a2.3 2.3 0 1 0 0-4.6 2.3 2.3 0 0 0 0 4.6z"/>
              </svg>
            </button>
          </div>
          <div class="pwHelp">
            <div class="pwHelp__row"><meter class="pwMeter" id="invitePwMeter" min="0" max="4" value="0"></meter><span class="pwMeter__text" id="invitePwText">Password strength</span></div>
            <ul class="pwRules" aria-label="Password requirements">
              <li>At least 8 characters</li>
              <li>At least 1 capital letter</li>
              <li>At least 1 special character</li>
            </ul>
          </div>
        </label>

        <label class="label">
          Confirm new password
          <div class="inputGroup">
            <input class="input" id="inviteConfirmPassword" name="confirmPassword" type="password" autocomplete="new-password" required />
            <button class="peekBtn" type="button" data-peek-target="inviteConfirmPassword" aria-label="Show password" aria-pressed="false">
              <svg class="peekBtn__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path fill="currentColor" d="M12 5c-5.5 0-9.6 4.2-11 7 1.4 2.8 5.5 7 11 7s9.6-4.2 11-7c-1.4-2.8-5.5-7-11-7zm0 11.5A4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 0 1 0 9zm0-2.2a2.3 2.3 0 1 0 0-4.6 2.3 2.3 0 0 0 0 4.6z"/>
              </svg>
            </button>
          </div>
        </label>
        <button class="btn btn--primary" type="submit">Complete setup</button>
        <div class="error" id="inviteError" role="alert" hidden></div>
        <div class="hint" id="inviteHint" aria-live="polite"></div>
      </form>
    </section>

    <section class="card" id="dashboardCard" aria-label="Admin dashboard" hidden>
      <div class="salutation" id="salutation" aria-live="polite"></div>

      <div class="financeTopBar noPrint" id="financeTopBar" aria-label="Finance totals" hidden>
        <div class="financePeriodTabs" role="tablist" aria-label="Finance period">
          <button class="miniTab miniTab--xs" id="financePeriodWeekBtn" type="button" role="tab" aria-selected="true">Wk</button>
          <button class="miniTab miniTab--xs" id="financePeriodMonthBtn" type="button" role="tab" aria-selected="false">Mon</button>
        </div>
        <div class="financeTopBar__label">Finance Totals</div>
        <span class="statusChip" id="financeIncomeTotal">$0.00 Income</span>
        <span class="statusChip" id="financeExpenseTotal">$0.00 Expense</span>
        <span class="statusChip" id="financeTithesTotal">$0.00 Tithes</span>
        <span class="statusChip" id="financeOfferingsTotal">$0.00 Offerings</span>
        <span class="statusChip" id="financeGivingTotal">$0.00 Total</span>
        <span class="statusChip" id="financeNetTotal">$0.00 Net</span>
      </div>

      <div class="adminLayout">
        <nav class="sideNav" role="tablist" aria-label="Admin sections">
          <button class="tab tab--nav" role="tab" aria-selected="true" aria-controls="tab-photos" id="tabBtn-photos">Photo Gallery</button>
          <button class="tab tab--nav" role="tab" aria-selected="false" aria-controls="tab-events" id="tabBtn-events">Events</button>
          <button class="tab tab--nav" role="tab" aria-selected="false" aria-controls="tab-content" id="tabBtn-content">Announcements</button>
          <button class="tab tab--nav" role="tab" aria-selected="false" aria-controls="tab-finances" id="tabBtn-finances">Finances</button>
          <button class="tab tab--nav" role="tab" aria-selected="false" aria-controls="tab-support" id="tabBtn-support">Support</button>
        </nav>

        <div class="adminMain">

      <!-- Photo Gallery -->
      <section class="tabPanel" role="tabpanel" id="tab-photos" aria-labelledby="tabBtn-photos">
        <div class="sectionHeader">
          <div class="sectionHeader__left">
            <h2 class="sectionHeader__title">Photo Gallery</h2>
            <div class="tabs subTabs photoSubTabs" role="tablist" aria-label="Photo gallery sections">
              <button class="tab tab--sub" role="tab" aria-selected="true" aria-controls="panel-photos-manage" id="subTabBtn-photos-manage" type="button">Upload</button>
              <button class="tab tab--sub" role="tab" aria-selected="false" aria-controls="panel-photos-bucket" id="subTabBtn-photos-bucket" type="button">Browse Bucket</button>
            </div>
          </div>
          <div class="iconGroup" aria-label="Photo gallery actions">
            <button class="iconBtn iconBtn--help" id="photoHelpBtn" type="button" aria-label="Photo upload instructions" title="Photo upload instructions">?</button>
            <button class="btn" id="exportBtn" type="button">Sync Gallery</button>
          </div>
        </div>

        <dialog class="dialog" id="photoHelpDialog" aria-label="Photo upload instructions">
          <form method="dialog" class="card dialog__inner">
            <div class="sectionHeader sectionHeader--compact">
              <h3 class="sectionHeader__title">Photo upload instructions</h3>
              <button class="btn" id="photoHelpCloseBtn" type="submit">Close</button>
            </div>

            <p class="muted">Use these steps when adding new albums and photos.</p>

            <h4 class="photosHelp__heading">Step-by-step</h4>
            <ol class="photosHelp__list">
              <li>Enter an <strong>Album</strong> name (example: <code>Youth Ministry</code>, <code>Choir</code>, <code>2026 Revival</code>).</li>
              <li>Add an optional <strong>Label</strong> (caption shown under the photo).</li>
              <li>Add optional <strong>Tags</strong> (comma-separated), like <code>youth, choir, 2026</code>.</li>
              <li>Select photos and click <strong>Upload</strong>.</li>
              <li>(Optional) Use <strong>Arrange Album</strong> to manually order photos.</li>
              <li>Click <strong>Sync Gallery</strong> so photos appear on the public gallery page.</li>
            </ol>

            <h4 class="photosHelp__heading">Tips</h4>
            <ul class="photosHelp__list">
              <li>Keep album names consistent to avoid duplicates (use <code>Youth Ministry</code> instead of both <code>Youth</code> and <code>Youth Ministry</code>).</li>
              <li>Use tags for groups (<code>ushers</code>), events (<code>revival</code>), and years (<code>2026</code>).</li>
            </ul>

            <div class="photosHelp__tip">Tip: If you uploaded photos but don’t see them on the website yet, you probably need to sync.</div>
          </form>
        </dialog>

        <div class="subTabPanel" role="tabpanel" id="panel-photos-manage" aria-labelledby="subTabBtn-photos-manage">
          <p class="muted">Upload photos and organize them by album. Tags help sorting and searching.</p>

          <form id="photoUploadForm" class="form form--row" enctype="multipart/form-data">
            <label class="label">
              Album (Events, Choir, Youth Ministry)
              <input class="input" name="album" type="text" placeholder="Events" />
            </label>
            <label class="label">
              Label (shown as text)
              <input class="input" name="label" type="text" placeholder="Youth Ministry" />
            </label>
            <label class="label">
              Tags (comma-separated)
              <input class="input" name="tags" type="text" placeholder="revival, 2026, sunday" />
            </label>
            <label class="label">
              Select photos
              <input class="input" name="images" type="file" accept="image/*" multiple required />
            </label>
            <button class="btn btn--primary" type="submit">Upload</button>
            <div class="hint" id="photoUploadHint" aria-live="polite"></div>
          </form>

          <div class="toolbar toolbar--nowrap" aria-label="Photo sorting and filters">
            <label class="label label--inline">
              Sort
              <select class="select" id="photoSort">
                <option value="date-desc">Date (newest)</option>
                <option value="date-asc">Date (oldest)</option>
                <option value="name-asc">Name (A–Z)</option>
                <option value="name-desc">Name (Z–A)</option>
                <option value="manual">Manual (arranged)</option>
              </select>
            </label>
            <label class="label label--inline">
              Arrange Album
              <select class="select" id="photoArrangeAlbum">
                <option value="">(Pick an album)</option>
              </select>
            </label>
            <label class="label label--inline">
              Filter Album
              <input class="input" id="photoAlbumFilter" type="text" placeholder="Events" />
            </label>
            <label class="label label--inline">
              Search tags
              <input class="input" id="photoTagFilter" type="text" placeholder="youth" />
            </label>
          </div>

          <div class="grid" id="photoGrid" aria-live="polite"></div>
        </div>

        <div class="subTabPanel" role="tabpanel" id="panel-photos-bucket" aria-labelledby="subTabBtn-photos-bucket" hidden>
          <div class="card r2BrowserCard" aria-label="Bucket browser">
            <div class="sectionHeader sectionHeader--compact">
              <h3 class="sectionHeader__title">Bucket Browser</h3>
              <button class="btn" id="r2RefreshBtn" type="button">Refresh</button>
            </div>
            <p class="muted">Browse and manage objects under <code>gallery/</code> in the R2 bucket.</p>

            <label class="label">
              Prefix
              <input class="input" id="r2PrefixInput" type="text" value="gallery/" />
            </label>

            <div class="inlineRow" aria-label="Bucket actions">
              <button class="btn" id="r2GoBtn" type="button">Go</button>
              <button class="btn" id="r2UpBtn" type="button">Up</button>
              <button class="btn btn--primary" id="r2SyncFolderBtn" type="button">Sync This Folder</button>
            </div>

            <div class="hint" id="r2Status" aria-live="polite"></div>
            <div class="r2Breadcrumb" id="r2Breadcrumb" aria-label="Bucket breadcrumb"></div>
            <div class="r2Tree" id="r2Tree" aria-live="polite"></div>
          </div>
        </div>

      </section>

      <!-- Content -->
      <section class="tabPanel" role="tabpanel" id="tab-content" aria-labelledby="tabBtn-content" hidden>
        <div class="sectionHeader">
          <h2 class="sectionHeader__title">Announcements</h2>
          <div class="tabs subTabs" role="tablist" aria-label="Announcements sections">
            <button class="tab tab--sub" role="tab" aria-selected="true" aria-controls="panel-content-announcements" id="subTabBtn-content-announcements" type="button">Announcements</button>
            <button class="tab tab--sub" role="tab" aria-selected="false" aria-controls="panel-content-bulletins" id="subTabBtn-content-bulletins" type="button">Bulletins</button>
          </div>
        </div>

        <div class="subTabPanel" role="tabpanel" id="panel-content-announcements" aria-labelledby="subTabBtn-content-announcements">
          <h3 id="announcements" class="srOnly">Announcements</h3>
          <form id="announceForm" class="form">
            <label class="label">
              Title
              <input class="input" name="title" type="text" maxlength="120" required />
            </label>
            <label class="label">
              Message
              <textarea class="textarea" name="body" rows="4" maxlength="5000" required></textarea>
            </label>
            <div class="inlineRow" aria-label="Announcement scheduling">
              <label class="label label--inline">
                Expires (days)
                <input class="input" name="expiresInDays" type="number" min="1" max="365" value="30" />
              </label>
              <label class="label label--inline">
                <input class="checkbox" name="neverExpires" type="checkbox" />
                Never expires
              </label>
              <button class="btn btn--primary" type="submit">Post Announcement</button>
            </div>
            <div class="hint">Leave blank to use the default (30 days). Set "Never expires" to keep it permanently.</div>
            <div class="hint" id="announceHint" aria-live="polite"></div>
          </form>
          <div class="list" id="announceList"></div>
        </div>

        <div class="subTabPanel" role="tabpanel" id="panel-content-bulletins" aria-labelledby="subTabBtn-content-bulletins" hidden>
          <h3 id="bulletins" class="srOnly">Bulletins</h3>
          <form id="bulletinForm" class="form" enctype="multipart/form-data">
            <div class="formRow">
              <label class="label">
                Title
                <input class="input" name="title" type="text" maxlength="120" placeholder="Sunday Bulletin" required />
              </label>
              <label class="label">
                Show from
                <input class="input" name="startsAt" type="datetime-local" required />
              </label>
              <label class="label">
                Show until
                <input class="input" name="endsAt" type="datetime-local" required />
              </label>
            </div>

            <div class="formRow">
              <label class="label">
                File (PDF or image)
                <input class="input" name="file" type="file" accept="application/pdf,image/*" required />
                <div class="hint">This will display on the homepage below the announcement ticker during the scheduled window.</div>
              </label>
            </div>

            <label class="label label--inline">
              <input class="checkbox" name="createAnnouncement" type="checkbox" />
              Create a coordinated announcement for this bulletin
            </label>

            <div class="formRow">
              <label class="label">
                Announcement title (optional)
                <input class="input" name="announcementTitle" type="text" maxlength="120" placeholder="New Bulletin Available" />
              </label>
              <label class="label">
                Announcement message (optional)
                <input class="input" name="announcementBody" type="text" maxlength="5000" placeholder="Click the bulletin frame on the homepage to view." />
              </label>
            </div>

            <button class="btn btn--primary" type="submit">Schedule Bulletin</button>
            <div class="hint" id="bulletinHint" aria-live="polite"></div>
          </form>
          <div class="list" id="bulletinList"></div>
        </div>
      </section>

      <!-- Finances -->
      <section class="tabPanel" role="tabpanel" id="tab-finances" aria-labelledby="tabBtn-finances" hidden>
        <div class="sectionHeader financeHeader">
          <div class="financeHeaderLeftTop">
            <div class="financeHeaderTitleRow">
              <h2 class="sectionHeader__title">Finances</h2>

              <div class="iconGroup noPrint" aria-label="Finance actions">
                <details class="menu" id="financePrintMenu">
                  <summary class="iconBtn" aria-label="Print" title="Print">
                    <svg class="iconBtn__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                      <path fill="currentColor" d="M6 7V3h12v4H6zm12 2h1a3 3 0 0 1 3 3v5h-4v4H6v-4H2v-5a3 3 0 0 1 3-3h1V9h12v0zm-2 12v-6H8v6h8zm2-10a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
                    </svg>
                    <span class="srOnly">Print</span>
                  </summary>
                  <div class="menu__panel" role="menu" aria-label="Print reports">
                    <div class="menu__title">Print reports</div>

                    <button class="menu__item" id="printFinanceLedgerBtn" type="button" role="menuitem">Finance ledger (current filters)</button>

                    <button class="menu__item" id="printFinanceReceiptsBtn" type="button" role="menuitem">Receipts (select entries)</button>

                    <div class="menu__divider" role="separator" aria-hidden="true"></div>

                    <div class="menu__title">Events</div>
                    <button class="menu__item" id="printEventsAllBtn" type="button" role="menuitem">All events</button>

                    <div class="menu__custom">
                      <div class="formRow">
                        <label class="label">
                          Group (same title)
                          <select class="select" id="printEventsGroupTitle"></select>
                        </label>
                        <button class="btn btn--primary" id="printEventsGroupBtn" type="button">Print group</button>
                      </div>
                      <div class="formRow">
                        <label class="label">
                          Single event
                          <select class="select" id="printEventId"></select>
                        </label>
                        <button class="btn btn--primary" id="printEventBtn" type="button">Print event</button>
                      </div>
                    </div>
                  </div>
                </details>
                <button class="iconBtn" id="financeExportCsvBtn" type="button" aria-label="Export CSV" title="Export CSV">
                  <svg class="iconBtn__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path fill="currentColor" d="M5 20a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h7l2 2h5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5zm7-11v6.17l1.59-1.58L15 15l-3 3-3-3 1.41-1.41L12 15.17V9h0z"/>
                  </svg>
                  <span class="srOnly">Export CSV</span>
                </button>
              </div>
            </div>
          </div>

          <div class="financeHeaderLeftBottom">
            <div class="financeQuickTabs noPrint" id="financeQuickTabs" role="tablist" aria-label="Finance quick tabs">
              <button class="miniTab" type="button" role="tab" aria-selected="true" data-fin-kind="income">Income</button>
              <button class="miniTab" type="button" role="tab" aria-selected="false" data-fin-kind="expense">Expense</button>
              <button class="miniTab" type="button" role="tab" aria-selected="false" data-fin-kind="tithes">Tithes</button>
              <button class="miniTab" type="button" role="tab" aria-selected="false" data-fin-kind="offerings">Offering</button>
            </div>
          </div>

          <form class="financeHeaderSearch noPrint" id="financeSearchForm" role="search" aria-label="Search finances">
            <div class="inputGroup">
              <input class="input" id="financeSearch" type="search" placeholder="Search ledger…" autocomplete="off" />
              <button class="inputIconBtn" type="submit" aria-label="Search" title="Search">
                <svg class="inputIconBtn__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path fill="currentColor" d="M10 2a8 8 0 1 1 5.3 13.9l4.4 4.4-1.4 1.4-4.4-4.4A8 8 0 0 1 10 2zm0 2a6 6 0 1 0 0 12 6 6 0 0 0 0-12z"/>
                </svg>
              </button>
            </div>
          </form>

          <div class="financeHeaderRight noPrint">
            <details class="menu" id="financeFilterMenu">
              <summary class="iconBtn" aria-label="Filters" title="Filters">
                <svg class="iconBtn__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path fill="currentColor" d="M3 5h18v2l-7 8v5l-4-2v-3L3 7V5z"/>
                </svg>
                <span class="srOnly">Filters</span>
              </summary>
              <div class="menu__panel" role="menu" aria-label="Filters">
                <div class="menu__title">Date range</div>

                <label class="menu__checkItem" role="menuitemcheckbox">
                  <input class="menu__check" type="checkbox" data-fin-range="7" />
                  <span>Last 7 days</span>
                </label>
                <label class="menu__checkItem" role="menuitemcheckbox">
                  <input class="menu__check" type="checkbox" data-fin-range="30" />
                  <span>Last 30 days</span>
                </label>
                <label class="menu__checkItem" role="menuitemcheckbox">
                  <input class="menu__check" type="checkbox" data-fin-range="90" />
                  <span>Last 90 days</span>
                </label>
                <label class="menu__checkItem" role="menuitemcheckbox">
                  <input class="menu__check" type="checkbox" data-fin-range="custom" id="financeCustomToggle" />
                  <span>Custom</span>
                </label>

                <div class="menu__custom" id="financeCustomRange" hidden>
                  <div class="formRow">
                    <label class="label">
                      From
                      <input class="input" id="financeFrom" type="date" />
                    </label>
                    <label class="label">
                      To
                      <input class="input" id="financeTo" type="date" />
                    </label>
                  </div>
                  <div class="toolbar toolbar--tightTop">
                    <button class="btn btn--primary" id="financeApplyCustomRangeBtn" type="button">Apply</button>
                    <button class="btn" id="financeClearRangeBtn" type="button">Clear</button>
                  </div>
                </div>

                <div class="menu__divider" role="separator" aria-hidden="true"></div>

                <div class="menu__title menu__title--spaced">Type</div>
                <label class="menu__checkItem" role="menuitemcheckbox">
                  <input class="menu__check" type="checkbox" id="financeTypeIncome" checked />
                  <span>Income</span>
                </label>
                <label class="menu__checkItem" role="menuitemcheckbox">
                  <input class="menu__check" type="checkbox" id="financeTypeExpense" checked />
                  <span>Expense</span>
                </label>
              </div>
            </details>
          </div>
        </div>

        <p class="muted noPrint">Add income and expenses, filter the ledger, export to CSV, and print cleanly.</p>

        <div class="financePrintHeader printOnly" aria-label="Print header">
          <div class="financePrintHeader__title" id="financePrintTitle">Mt. Moriah Missionary Baptist Church — Finance</div>
          <div class="financePrintHeader__meta" id="financePrintMeta"></div>
        </div>

        <dialog class="dialog" id="financeReceiptsDialog" aria-label="Print receipts">
          <form method="dialog" class="card dialog__inner">
            <div class="sectionHeader sectionHeader--compact">
              <h3 class="sectionHeader__title">Print receipts</h3>
              <button class="btn" id="financeReceiptsCloseBtn" type="submit">Close</button>
            </div>

            <p class="muted">Search and select one, multiple, or all finance entries to print as receipts.</p>

            <div class="toolbarGroup">
              <div class="inputGroup financeReceiptsSearchGroup">
                <input class="input" id="financeReceiptsSearch" type="search" placeholder="Search entries…" autocomplete="off" />
                <button class="inputIconBtn" id="financeReceiptsSearchClear" type="button" aria-label="Clear search" title="Clear">×</button>
              </div>
              <button class="btn" id="financeReceiptsSelectAllBtn" type="button">Select all</button>
              <button class="btn" id="financeReceiptsClearBtn" type="button">Clear</button>
            </div>

            <div class="hint" id="financeReceiptsCount" aria-live="polite"></div>
            <div class="list list--scroll5" id="financeReceiptsList" aria-label="Receipt entries"></div>

            <div class="toolbar">
              <button class="btn btn--primary" id="financeReceiptsPrintSelectedBtn" type="button">Print selected</button>
              <button class="btn" id="financeReceiptsPrintAllBtn" type="button">Print all (current filters)</button>
            </div>
          </form>
        </dialog>

        <div class="printOnly" id="adminPrintBody" aria-label="Print report body"></div>

        <form id="financeEntryForm" class="form noPrint" aria-label="Add or edit ledger entry">
          <input id="financeEditId" type="hidden" />

          <div class="formRow">
            <label class="label">
              Date
              <input class="input" id="financeDate" type="date" required />
            </label>
            <label class="label">
              Type
              <select class="select" id="financeType" required>
                <option value="income">Income</option>
                <option value="expense">Expense</option>
              </select>
            </label>
            <label class="label">
              Category
              <input class="input" id="financeCategory" type="text" list="financeCategoriesList" placeholder="Tithes" required />
            </label>
            <label class="label">
              Fund
              <input class="input" id="financeFund" type="text" list="financeFundsList" placeholder="General" />
            </label>
            <label class="label">
              Method
              <select class="select" id="financeMethod">
                <option value="">(Any)</option>
                <option value="cash">Cash</option>
                <option value="check">Check</option>
                <option value="card">Card</option>
                <option value="online">Online</option>
                <option value="other">Other</option>
              </select>
            </label>
            <label class="label">
              Amount
              <input class="input" id="financeAmount" type="number" inputmode="decimal" min="0" step="0.01" placeholder="0.00" required />
            </label>
          </div>

          <div class="formRow">
            <label class="label">
              <span id="financePartyLabel">From (optional)</span>
              <input class="input" id="financeParty" type="text" maxlength="120" placeholder="John Doe / Vendor" />
            </label>
            <label class="label">
              Memo (optional)
              <input class="input" id="financeMemo" type="text" maxlength="200" placeholder="Notes" />
            </label>
          </div>

          <div class="toolbar noPrint">
            <button class="btn btn--primary" id="financeSaveBtn" type="submit">Add Entry</button>
            <button class="btn" id="financeCancelEditBtn" type="button" hidden>Cancel Edit</button>
            <div class="hint" id="financeHint" aria-live="polite"></div>
          </div>
        </form>

        <datalist id="financeCategoriesList"></datalist>
        <datalist id="financeFundsList"></datalist>

        <div class="divider"></div>

        <div class="tableWrap" aria-label="Ledger table">
          <table class="financeTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Category</th>
                <th>Fund</th>
                <th>Method</th>
                <th>From/To</th>
                <th>Memo</th>
                <th class="num">Amount</th>
                <th class="noPrint">Actions</th>
              </tr>
            </thead>
            <tbody id="financeTableBody"></tbody>
          </table>
        </div>
      </section>

      <!-- Events -->
      <section class="tabPanel" role="tabpanel" id="tab-events" aria-labelledby="tabBtn-events" hidden>
        <h2>Events</h2>
        <p class="muted">Add, edit, and delete events. This exports to the website's existing schedule format when exports are enabled.</p>

        <form id="eventForm" class="form form--row">
          <label class="label">
            Title
            <input class="input" name="title" type="text" required />
          </label>
          <label class="label">
            Date
            <input class="input" name="date" type="date" required />
          </label>
          <label class="label">
            Time
            <div class="timePicker" id="eventTimePicker" data-time-picker="optional"></div>
            <input class="input" id="eventTime" name="time" type="hidden" />
          </label>
          <button class="btn btn--primary" type="submit">Add Event</button>
          <div class="hint" id="eventHint" aria-live="polite"></div>
        </form>

        <div class="list list--scrollEvents" id="eventList"></div>
      </section>

      <!-- Support -->
      <section class="tabPanel" role="tabpanel" id="tab-support" aria-labelledby="tabBtn-support" hidden>
        <h2>Support</h2>
        <p class="muted">Send a message to support. This will email <strong>hligon@getsparqd.com</strong>.</p>

        <form id="supportForm" class="form">
          <label class="label">
            Subject
            <input class="input" name="subject" type="text" maxlength="140" placeholder="Need help with the admin" required />
          </label>
          <label class="label">
            Message
            <textarea class="textarea" name="message" rows="6" maxlength="5000" placeholder="Describe what you need help with…" required></textarea>
          </label>
          <label class="label">
            Your email (optional)
            <input class="input" name="replyTo" type="email" maxlength="254" placeholder="you@example.com" />
          </label>
          <button class="btn btn--primary" type="submit">Send to support</button>
          <div class="hint" id="supportHint" aria-live="polite"></div>
          <div class="error" id="supportError" role="alert" hidden></div>
        </form>
      </section>



        </div>
      </div>
    </section>
  </main>

  <script src="admin.js"></script>
</body>
</html>
